# Developer Role – AI Study Buddy

## Vision
Build a robust, modular application using FastAPI for the backend, integrating Gemini 1.5 Pro API for AI-powered text generation, and PyMuPDF for PDF parsing. Ensure seamless communication between the backend and a React/Tailwind frontend, enabling efficient file uploads, processing, and delivery of study aids to students.

## Responsibilities
- Set up the backend with FastAPI (Python) to handle API endpoints, file uploads, and integration with Gemini API.
- Implement PDF parsing using PyMuPDF to extract text from uploaded notes.
- Connect to Gemini 1.5 Pro API for generating summaries, flashcards, and quizzes.
- Develop endpoints for frontend consumption, ensuring secure and efficient data flow.
- Document all code and integration steps.

## Deliverables
- Fully working prototype in the `src/` folder.
- Well-commented codebase with clear API documentation.
- Integrated AI functionality using Gemini API.
- Example scripts and test cases.

---

## Prompts and AI Responses

### Prompt 1 – Backend Structure
**Prompt:**  
Design the backend architecture using FastAPI. What endpoints are needed for file upload, text extraction, and AI processing? Describe the structure and flow.

**AI Response:**  
- `/upload`: POST endpoint for uploading PDF or text files.  
- `/extract`: Internal function or endpoint to extract text from the uploaded file using PyMuPDF.  
- `/generate`: POST endpoint that sends extracted text and user preferences to Gemini API, returning summaries, flashcards, and quizzes.  
- Flow: Upload file → Extract text → Send to Gemini → Return results to frontend.

### Prompt 2 – Flashcard Generator
**Prompt:**  
Create an endpoint in FastAPI that receives extracted text and returns a list of flashcard Q&A pairs generated by Gemini API. Provide example input/output.

**AI Response:**  
- Endpoint: `/generate/flashcards`  
- Input: JSON with `"text": "..."` and `"num_flashcards": 10`  
- Output: JSON with a list of flashcards: `[{"question": "...", "answer": "..."}, ...]`  
- Example:  
  ```json
  {
    "flashcards": [
      {"question": "What is ...?", "answer": "..."},
      {"question": "Explain ...", "answer": "..."}
    ]
  }
  ```

### Prompt 3 – Frontend Integration
**Prompt:**  
Describe how the React frontend should interact with the FastAPI backend. Outline the API calls and data flow for uploading a file and displaying results.

**AI Response:**  
- User uploads a file using the React UI, which sends a POST request to `/upload`.
- After upload, the frontend receives a status or file ID.
- The frontend sends a POST request to `/generate` with the extracted text and user preferences.
- The backend responds with generated summaries, flashcards, and quizzes.
- The frontend displays the results in organized sections (tabs or cards), allowing the user to copy or download content.

---

### Implementation Log – Backend Development

**Task:** Added FastAPI backend with endpoints `/upload/` and `/generate/flashcards/`  
**AI Role:** Developer Agent  
**Prompt Used:**  
“Create a FastAPI backend with endpoints to upload PDF/text files and generate summaries and flashcards using Gemini API.”  

**Result:**  
- Implemented working backend with two routes.  
- Supports PDF and text parsing via PyMuPDF.  
- Successfully connects to Gemini 1.5 Pro.  
- Tested locally on `http://127.0.0.1:8000/docs`.  

**Reflection:**  
The agent produced working code on first try. Adjustments were made for Python 3.9 and environment setup on macOS (LibreSSL warning). Functionality verified successfully.

---

### Implementation Log – Frontend Integration (Planned)

**Task:** Plan the integration of the frontend (HTML/JS) with the FastAPI backend for file upload and Gemini response display.  
**AI Role:** Developer Agent  
**Prompt Used:**  
“Describe how the frontend should interact with the FastAPI backend. Outline API calls and data flow for uploading a file and displaying results.”

**Planned Implementation:**  
- Create `index.html`, `script.js`, and `style.css` inside `src/`.  
- File upload form will connect to `http://127.0.0.1:8000/upload/`.  
- Backend response (summaries and flashcards) will be rendered dynamically in the browser.  
- Frontend will later be migrated to React/Tailwind.

**Reflection:**  
The integration plan defines how the user interface will communicate with the backend.  
Next development cycle will involve implementing and testing the static frontend to complete the full workflow.

#### Prompt 4 – Markdown Rendering and Output Enhancement
**Prompt:**  
Enhance the backend so that summaries returned from the Gemini API render correctly in the frontend. The Gemini API often responds in Markdown format, but the browser currently displays it as one long unformatted block.  
Implement Markdown → HTML conversion in the FastAPI backend before sending responses to the frontend.  
Document the change and update the development log accordingly.

**Planned Implementation:**  
To improve the readability of summaries generated by the Gemini API, the backend was updated to convert Markdown-formatted responses into HTML before returning them to the frontend. This ensures that text displays properly in the browser with headings, bullet points, and paragraphs.

**Steps to Execute:**  
1. Activate the virtual environment:
   ```bash
   source ~/Documents/Projects/AI-Study-Buddy/Prosjekt/backend/.venv/bin/activate
   ```  
2. Install the Markdown library:
   ```bash
   pip install markdown
   ```  
3. Import the library at the top of `main.py`:
   ```python
   import markdown
   ```  
4. Update the `/upload` endpoint:  
   Convert `response.text` to HTML before returning it:
   ```python
   html_output = markdown.markdown(response.text)
   return {"summary": html_output}
   ```  
5. Run and test using Swagger UI:
   ```bash
   python3 -m uvicorn main:app --reload
   ```  
   - Upload a test PDF using `/upload`
   - Confirm that the response now includes formatted HTML elements like `<h2>`, `<ul>`, and `<p>`.

### Implementation Log – Markdown Rendering (Completed)

**Task:** Implemented Markdown-to-HTML rendering for Gemini API output  
**AI Role:** Developer Agent  
**Prompt Used:** “Enhance the backend so that summaries returned from the Gemini API render correctly in the frontend.”

**Result:**  
- Installed and imported the `markdown` library.  
- Updated `/upload` endpoint in `main.py` to convert `response.text` → HTML using `markdown.markdown(response.text)`.  
- Verified functionality via Swagger UI (`http://127.0.0.1:8000/docs`).  
- AI-generated summaries are now returned as clean HTML with headings, lists, and paragraph formatting.

**Reflection:**  
This update ensures that all summaries from Gemini are properly structured and visually readable in the browser without additional frontend processing. The implementation improves clarity, accessibility, and user experience in the AI Study Buddy frontend.