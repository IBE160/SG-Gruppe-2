# Developer Role ‚Äì AI Study Buddy

## Vision
Build a robust, modular application using FastAPI for the backend, integrating Gemini 1.5 Pro API for AI-powered text generation, and PyMuPDF for PDF parsing. Ensure seamless communication between the backend and a React/Tailwind frontend, enabling efficient file uploads, processing, and delivery of study aids to students.

## Responsibilities
- Set up the backend with FastAPI (Python) to handle API endpoints, file uploads, and integration with Gemini API.
- Implement PDF parsing using PyMuPDF to extract text from uploaded notes.
- Connect to Gemini 1.5 Pro API for generating summaries, flashcards, and quizzes.
- Develop endpoints for frontend consumption, ensuring secure and efficient data flow.
- Document all code and integration steps.

## Deliverables
- Fully working prototype in the `src/` folder.
- Well-commented codebase with clear API documentation.
- Integrated AI functionality using Gemini API.
- Example scripts and test cases.

---

## Prompts and AI Responses

### Prompt 1 ‚Äì Backend Structure
**Prompt:**  
Design the backend architecture using FastAPI. What endpoints are needed for file upload, text extraction, and AI processing? Describe the structure and flow.

**AI Response:**  
- `/upload`: POST endpoint for uploading PDF or text files.  
- `/extract`: Internal function or endpoint to extract text from the uploaded file using PyMuPDF.  
- `/generate`: POST endpoint that sends extracted text and user preferences to Gemini API, returning summaries, flashcards, and quizzes.  
- Flow: Upload file ‚Üí Extract text ‚Üí Send to Gemini ‚Üí Return results to frontend.

### Prompt 2 ‚Äì Flashcard Generator
**Prompt:**  
Create an endpoint in FastAPI that receives extracted text and returns a list of flashcard Q&A pairs generated by Gemini API. Provide example input/output.

**AI Response:**  
- Endpoint: `/generate/flashcards`  
- Input: JSON with `"text": "..."` and `"num_flashcards": 10`  
- Output: JSON with a list of flashcards: `[{"question": "...", "answer": "..."}, ...]`  
- Example:  
  ```json
  {
    "flashcards": [
      {"question": "What is ...?", "answer": "..."},
      {"question": "Explain ...", "answer": "..."}
    ]
  }
  ```

### Prompt 3 ‚Äì Frontend Integration
**Prompt:**  
Describe how the React frontend should interact with the FastAPI backend. Outline the API calls and data flow for uploading a file and displaying results.

**AI Response:**  
- User uploads a file using the React UI, which sends a POST request to `/upload`.
- After upload, the frontend receives a status or file ID.
- The frontend sends a POST request to `/generate` with the extracted text and user preferences.
- The backend responds with generated summaries, flashcards, and quizzes.
- The frontend displays the results in organized sections (tabs or cards), allowing the user to copy or download content.

---

### Implementation Log ‚Äì Backend Development

**Task:** Added FastAPI backend with endpoints `/upload/` and `/generate/flashcards/`  
**AI Role:** Developer Agent  
**Prompt Used:**  
‚ÄúCreate a FastAPI backend with endpoints to upload PDF/text files and generate summaries and flashcards using Gemini API.‚Äù  

**Result:**  
- Implemented working backend with two routes.  
- Supports PDF and text parsing via PyMuPDF.  
- Successfully connects to Gemini 1.5 Pro.  
- Tested locally on `http://127.0.0.1:8000/docs`.  

**Reflection:**  
The agent produced working code on first try. Adjustments were made for Python 3.9 and environment setup on macOS (LibreSSL warning). Functionality verified successfully.

---

### Implementation Log ‚Äì Frontend Integration (Planned)

**Task:** Plan the integration of the frontend (HTML/JS) with the FastAPI backend for file upload and Gemini response display.  
**AI Role:** Developer Agent  
**Prompt Used:**  
‚ÄúDescribe how the frontend should interact with the FastAPI backend. Outline API calls and data flow for uploading a file and displaying results.‚Äù

**Planned Implementation:**  
- Create `index.html`, `script.js`, and `style.css` inside `src/`.  
- File upload form will connect to `http://127.0.0.1:8000/upload/`.  
- Backend response (summaries and flashcards) will be rendered dynamically in the browser.  
- Frontend will later be migrated to React/Tailwind.

**Reflection:**  
The integration plan defines how the user interface will communicate with the backend.  
Next development cycle will involve implementing and testing the static frontend to complete the full workflow.

#### Prompt 4 ‚Äì Markdown Rendering and Output Enhancement
**Prompt:**  
Enhance the backend so that summaries returned from the Gemini API render correctly in the frontend. The Gemini API often responds in Markdown format, but the browser currently displays it as one long unformatted block.  
Implement Markdown ‚Üí HTML conversion in the FastAPI backend before sending responses to the frontend.  
Document the change and update the development log accordingly.

**Planned Implementation:**  
To improve the readability of summaries generated by the Gemini API, the backend was updated to convert Markdown-formatted responses into HTML before returning them to the frontend. This ensures that text displays properly in the browser with headings, bullet points, and paragraphs.

**Steps to Execute:**  
1. Activate the virtual environment:
   ```bash
   source ~/Documents/Projects/AI-Study-Buddy/Prosjekt/backend/.venv/bin/activate
   ```  
2. Install the Markdown library:
   ```bash
   pip install markdown
   ```  
3. Import the library at the top of `main.py`:
   ```python
   import markdown
   ```  
4. Update the `/upload` endpoint:  
   Convert `response.text` to HTML before returning it:
   ```python
   html_output = markdown.markdown(response.text)
   return {"summary": html_output}
   ```  
5. Run and test using Swagger UI:
   ```bash
   python3 -m uvicorn main:app --reload
   ```  
   - Upload a test PDF using `/upload`
   - Confirm that the response now includes formatted HTML elements like `<h2>`, `<ul>`, and `<p>`.

### Implementation Log ‚Äì Markdown Rendering (Completed)

**Task:** Implemented Markdown-to-HTML rendering for Gemini API output  
**AI Role:** Developer Agent  
**Prompt Used:** ‚ÄúEnhance the backend so that summaries returned from the Gemini API render correctly in the frontend.‚Äù

**Result:**  
- Installed and imported the `markdown` library.  
- Updated `/upload` endpoint in `main.py` to convert `response.text` ‚Üí HTML using `markdown.markdown(response.text)`.  
- Verified functionality via Swagger UI (`http://127.0.0.1:8000/docs`).  
- AI-generated summaries are now returned as clean HTML with headings, lists, and paragraph formatting.

**Reflection:**  
This update ensures that all summaries from Gemini are properly structured and visually readable in the browser without additional frontend processing. The implementation improves clarity, accessibility, and user experience in the AI Study Buddy frontend.


### Prompt 5 ‚Äì Frontend Phase 2 (Dynamic Integration)
**Prompt:**  
Develop and connect the full frontend prototype (HTML, CSS, JS) to the FastAPI backend.  
Implement navigation between Upload, Results, and Settings sections. Ensure data flows dynamically and displays AI-generated results properly.

**Requirements:**
- Use `fetch()` for POST requests to `/upload` and `/generate/flashcards/`.  
- Render Markdown-formatted summaries as HTML in the browser.  
- Maintain accessibility and responsiveness.  
- Organize scripts and styles clearly within `src/`.

**Deliverables:**
- Updated `index.html`, `style.css`, and `script.js` files in `/src`.  
- Functional upload-to-result workflow.  
- Confirmed data binding with FastAPI backend.  
- Documentation in `docs/dev_log.md`.

**Reflection:**  
This phase establishes the full interaction loop between frontend and backend, ensuring the prototype works end-to-end for student users.

---

### Prompt 6 ‚Äì Quiz Generator (Final Integration)
**Prompt:**  
Develop a robust quiz generation system that ensures Gemini 2.5 Flash produces valid, structured JSON output compatible with the frontend. The model should generate five multiple-choice questions (A‚ÄìD) with one correct answer, returned in a consistent JSON format. Include detailed instructions to Gemini so it reliably returns the expected structure. Implement backend parsing logic that cleans the model response, validates the JSON, and maps the correct letter (A‚ÄìD) to the corresponding answer text.  

**AI Response:**  
- Implement a clear prompt sent to Gemini 2.5 Flash that enforces strict JSON formatting:  
  ```json
  {
    "quiz": [
      {
        "question": "Question text",
        "options": ["A. ...", "B. ...", "C. ...", "D. ..."],
        "answer": "B"
      }
    ]
  }
  ```
- In the FastAPI backend, strip any Markdown code fences (```json ... ```), use regex to extract valid JSON, and parse it safely with `json.loads()`.  
- For each question, match the `"answer"` key (A‚ÄìD) to the actual option text, then output an array of quiz objects with `question`, `options`, and `correct`.  
- Example final response sent to the frontend:
  ```json
  {
    "quiz": [
      {
        "question": "What is the main purpose of AI Study Buddy?",
        "options": ["A. Analyze data", "B. Generate study content", "C. Build websites", "D. Translate languages"],
        "correct": "B. Generate study content"
      }
    ]
  }
  ```

**Reflection:**  
This prompt enforces predictable, machine-readable structure for quiz generation. The backend logic ensures robust parsing even when Gemini adds Markdown or explanations. The frontend can now reliably display questions and correct answers without ‚Äúundefined‚Äù errors, completing the quiz functionality for the AI Study Buddy project.

---
# Developer Role ‚Äì AI Study Buddy (Multilingual Architecture)

## Vision
Develop a fully modular, multilingual AI-powered study assistant.  
The system must dynamically adapt to user language preferences (Norwegian or English) for **Summaries**, **Flashcards**, and **Quizzes** ‚Äî ensuring seamless interaction across backend and frontend.

---

## Core Components
- **Backend:** FastAPI (Python 3.9+)  
- **AI Integration:** Gemini 2.5 Flash / 1.5 Pro (via `google-genai`)  
- **File Handling:** PyMuPDF for PDF parsing  
- **Frontend:** HTML/JS prototype with Tailwind CSS (React-ready structure)  
- **Localization:** Dynamic prompt injection and output translation  
- **Data Flow:** File upload ‚Üí Text extraction ‚Üí AI processing ‚Üí Result rendering

---

## Backend Responsibilities
1. Set up FastAPI endpoints for:
   - `/upload` ‚Üí PDF upload and text extraction  
   - `/generate/summary` ‚Üí Summarization  
   - `/generate/flashcards` ‚Üí Flashcard generation  
   - `/generate/quiz` ‚Üí Quiz creation  
2. Integrate environment variables (`.env`) for Gemini API keys and project configs.  
3. Implement prompt templates that adjust language dynamically via a `settings` object.  
4. Sanitize Gemini responses: remove Markdown fences, ensure valid JSON.  
5. Serve structured responses for frontend rendering.

---

## Frontend Responsibilities
1. Build a clean, minimal interface with:
   - Tabs: **Upload**, **Results**, **Settings**
   - Language toggle: üá≥üá¥ Norsk / üá¨üáß English  
   - Dynamic rendering of summaries, flashcards, and quizzes.  
2. Use `fetch()` API to POST data to backend endpoints.
3. Store language preference and re-render all components accordingly.
4. Ensure accessibility and responsive design.

---

## Multilingual Prompt Design

### üß† Summary Prompt
```
You are an academic summarization assistant for the AI Study Buddy platform.

Summarize the following study text clearly and educationally.  
Respond in {{language}} (Norwegian or English).

Guidelines:
- Adapt summary length to user preference: {{summaryLength}} (Short, Medium, Long).
- Maintain academic, neutral tone.
- Use Markdown formatting (headings, bullet points).
- Avoid unnecessary repetition.
- Return only the formatted summary text.

Output only the summary ‚Äî no explanations or commentary.
```

---

### üß© Flashcard Prompt
```
You are a flashcard generator for the AI Study Buddy platform.

Generate exactly {{flashcardCount}} concise flashcards from the provided study text.  
Respond in {{language}} (Norwegian or English).

Each flashcard must follow this JSON structure:
{
  "flashcards": [
    {
      "front": "Question or concept prompt",
      "back": "Clear, correct explanation or answer"
    }
  ]
}

Guidelines:
- Use simple, educational phrasing.
- Avoid repetition or trivial facts.
- Output only valid JSON.
```

---

### üßÆ Quiz Prompt
```
You are an intelligent quiz generator for the AI Study Buddy platform.

Given the study text, create a multiple-choice quiz in {{language}}.  
Return only valid JSON ‚Äî nothing else.

Expected structure:
{
  "quiz": [
    {
      "question": "string",
      "options": ["A", "B", "C", "D"],
      "answer": "string"
    }
  ]
}

Guidelines:
- Each question has four options and one correct answer.
- Use factual, unambiguous phrasing.
- Avoid meta explanations or introductory text.
```

---

## Dynamic Language Implementation
- `main.py` backend injects `{{language}}` dynamically from `/settings`.
- Frontend `settings.js` stores and retrieves selected language from localStorage.
- All API calls include language preference in payload:
  ```json
  { "text": "...", "language": "Norwegian" }
  ```
- Default fallback: English.

---

## Technical Notes
- Added multilingual Markdown ‚Üí HTML conversion in backend.
- Implemented strict JSON validation for AI output parsing.
- Introduced unified prompt templates for all AI tasks.
- Linked `settings` page to update prompt language across all components.

---

## Outcome
‚úÖ Gemini dynamically generates summaries, flashcards, and quizzes in either Norwegian or English.  
‚úÖ Frontend updates content in real-time when switching language.  
‚úÖ Backend ensures valid JSON structure and localized responses.  
‚úÖ AI Study Buddy achieves **full multilingual functionality** across all learning modules.

---

## Next Steps
- Expand localization with additional European languages (Phase 3.3).
- Add speech synthesis (TTS) for flashcards in selected language.
- Integrate user accounts and preference persistence (Supabase).

---